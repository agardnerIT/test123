apiVersion: argoproj.io/v1alpha1
kind: CronWorkflow
metadata:
  name: new-test-cron-wf
  namespace: default
spec:
  schedule: "* * * * *"
  concurrencyPolicy: "Replace"
  startingDeadlineSeconds: 0
  workflowSpec:
    entrypoint: whalesay
    templates:
    - name: whalesay
      container:
        image: ghcr.io/dynatrace-oss/bizevent-pusher:v1.1.1
        #command: [sh, -c]
        args: [
          "--tenant",
          "$(TENANT_URL)",
          "--oauth-client-id",
          "$(OAUTH_CLIENT_ID)",
          "--oauth-client-secret",
          "$(OAUTH_CLIENT_SECRET)",
          "--account_urn",
          "$(ACCOUNT_URN)",
          "--payload",
          "{ \"type\": \"workflow.execution\", \"app_name\": \"new-test-cron-wf\" }"
        ]
        env:
        - name: TENANT_URL
          valueFrom:
            secretKeyRef:
              name: dt-bizevent-oauth-details
              key: dtTenant
        - name: OAUTH_CLIENT_ID
          valueFrom:
            secretKeyRef:
              name: dt-bizevent-oauth-details
              key: oAuthClientID
        - name: OAUTH_CLIENT_SECRET
          valueFrom:
            secretKeyRef:
              name: dt-bizevent-oauth-details
              key: oAuthClientSecret
        - name: ACCOUNT_URN
          valueFrom:
            secretKeyRef:
              name: dt-bizevent-oauth-details
              key: accountURN

# apiVersion: argoproj.io/v1alpha1
# kind: CronWorkflow
# metadata:
#   name: test-cron-wf
#   namespace: default
# spec:
#   schedule: "* * * * *"
#   concurrencyPolicy: "Replace"
#   startingDeadlineSeconds: 0
#   workflowSpec:
#     entrypoint: test-cron-wf
#     templates:
#     - name: test-cron-wf
#       image: ghcr.io/dynatrace-oss/bizevent-pusher:v1.1.1
#       args: [
#         "--tenant",
#         "$(TENANT_URL)",
#         "--oauth-client-id",
#         "$(OAUTH_CLIENT_ID)",
#         "--oauth-client-secret",
#         "$(OAUTH_CLIENT_SECRET)",
#         "--account_urn",
#         "$(ACCOUNT_URN)",
#         "--payload",
#         "{ \"type\": \"workflow.execution\", \"app_name\": \"test-cron-wf\" }"
#       ]
#       env:
#       - name: TENANT_URL
#         valueFrom:
#           secretKeyRef:
#             name: dt-bizevent-oauth-details
#             key: dtTenant
#       - name: OAUTH_CLIENT_ID
#         valueFrom:
#           secretKeyRef:
#             name: dt-bizevent-oauth-details
#             key: oAuthClientID
#       - name: OAUTH_CLIENT_SECRET
#         valueFrom:
#           secretKeyRef:
#             name: dt-bizevent-oauth-details
#             key: oAuthClientSecret
#       - name: ACCOUNT_URN
#         valueFrom:
#           secretKeyRef:
#             name: dt-bizevent-oauth-details
#             key: accountURN
#     container:
#       image: alpine:3.6
#       command: [sh, -c]
#       args: ["echo hello from cron workflow; sleep 5"]